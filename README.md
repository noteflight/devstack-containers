# devstack-containers
Dockerfiles for various dev, test, and build operations

## Installing on a new Linux machine (either VM or actual machine)

### Set up credentials

* You will need credentials for github and for AWS
  * Github
    * Github recommends using Personal access tokens.  If you don't have one yet, [generate one here](https://github.com/settings/tokens).  This doesn't have to be Noteflight-specific, it's only specific to your Noteflight account.
    * Create (or add to) a `~/.netrc` file that looks like this:
      ```
      machine github.com login <github username> password <github personal access token>
      ```
      * This file allows git to automatically authenticate when using github.
        * There are multiple ways to store the access token so that it's used automatically.  The `.netrc` method is the way that I've found to be the most straightforward.  This method is assumed by the rest of the "devstack" system.
        * As a side-effect, this will also cause the `curl` program to use this authentication info when making calls to github.  Something to be aware of.
        * The other drawback is that your token is stored in plaintext in that file.  Just make sure your drive is encrypted, and expire/update your token regularly.
  * AWS
    * You will receive an AWS "access_key_id" and "secret_access_key" from the Noteflight administrator
    * Put those into these files, as recommended by AWS:
      * `~/.aws/credentials`:
        ```
        [noteflight]
        aws_access_key_id=<access key id>
        aws_secret_access_key=<secret access key>
        ```
        * The `[noteflight]` part is the "profile name".  You can have credentials for multiple profiles in there, which would probably be the case if you have multiple AWS accounts.  You can name the profile whatever you want - I'm assuming that it's going to be `noteflight`.
      * `~/.aws/config`:
        ```
        [noteflight]
        region=us-east-1
        output=json
        ```
        * Again - same thing about the profile name.  Use the same profile name you used in the previous step.

### Get the Noteflight repos

* Choose a directory to hold your Noteflight repos.  For example, `~/noteflight`
* Pull down the essential set of repos:
  ```
  cd ~/noteflight
  git clone https://github.com/noteflight/devstack-containers
  git clone https://github.com/noteflight/webapp
  git clone https://github.com/noteflight/devops-utils
  git clone https://github.com/noteflight/docs
  ```

### Set up environment variables
        
* You'll need the following variables in your environment.  You may want to add them to your `~/.bashrc` or `~/.bash_aliases` environment (or whatever file is appropriate to the shell you're using).
  * NF_REPOS - the location of your downloaded repos (`~/noteflight` for example)
  * NF_DEVSTACK_DATA - where you want to keep the data generated by the various services used in Noteflight development (mysql, elasticsearch, etc.).  For example, (`~/noteflight/devstack-data`)
  * NF_DEVSTACK_USER - the linux username that will be doing Noteflight development
  * NF_DEVSTACK_USER_DIR - the home directory of the user doing Noteflight development, e.g. `/home/arista`
  * NF_AWS_PROFILE - the name of the profile that you used in the `.aws` files above (e.g., `noteflight`)
  * NF_DEV_WEBSERVER_HOST - the hostname that you'll be using to access the Noteflight development web server.  If your browser and Noteflight server are running on the same machine, then this would just be `localhost`.  But if your linux machine is in a VM and the browser is running on the host, then this should be the IP address or hostname that you'll be using to get to the server on the VM (e.g., `192.168.56.101`).

### Set up your path

* Add the following to your path, again modifying your shell-specific files to do this:
  ```
  export PATH="${PATH}:${NF_REPOS}/devstack-containers/bin"
  ```
